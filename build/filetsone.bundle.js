var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{A:()=>l});class i{constructor(){this.url="",this.uploadOnDrop=!1,this.chunkSize=10485760}}class n extends i{constructor(){super(...arguments),this.initiateMultipartUrl="",this.fetchPresignUrl="",this.finalizeMultipartUrl=""}valid(){return""!==this.initiateMultipartUrl&&""!==this.fetchPresignUrl&&""!==this.finalizeMultipartUrl}}var o=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{a(n.next(t))}catch(t){r(t)}}function l(t){try{a(n.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,l)}a((n=n.apply(t,e||[])).next())}))};class r{constructor(){this.settings=new n}upload(t,e){return o(this,void 0,void 0,(function*(){if(this.settings=t.s3Settings,this.filetsone=t,!this.settings.valid())throw new Error("Settings invalid");const i=this.splitFile(e),n=yield this.initiateUpload(e),o=yield this.getPresignedUrls(n,i.length),r=yield this.uploadChunks(o,i);return this.finalizeUpload(n,r)}))}splitFile(t){const e=Math.ceil(t.size/this.settings.chunkSize),i=[];for(let n=0;n<e;n++)i.push(t.slice(n*this.settings.chunkSize,(n+1)*this.settings.chunkSize));return i}initiateUpload(t){return o(this,void 0,void 0,(function*(){this.filetsone&&this.filetsone.triggerHook("initiate_multipart_upload",t,this.settings.initiateMultipartUrl);const e=yield fetch(this.settings.initiateMultipartUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name})});if(!e.ok)throw new Error("Failed to initiate upload");const{key:i}=yield e.json();return i}))}getPresignedUrls(t,e){return o(this,void 0,void 0,(function*(){this.filetsone&&this.filetsone.triggerHook("get_multipart_presign_urls",t,e);const i=[];for(let n=1;n<=e;n++){const e=yield fetch(`${this.settings.fetchPresignUrl}?requestId=${t}&partNumber=${n}`);if(!e.ok)throw new Error(`Failed to get presigned URL for part ${n}`);const{url:o}=yield e.json();i.push(o)}return i}))}uploadChunks(t,e){return o(this,void 0,void 0,(function*(){this.filetsone&&this.filetsone.triggerHook("upload_multipart_chunk",t,e);const i=[];for(let n=0;n<e.length;n++){const o=yield fetch(t[n],{method:"PUT",body:e[n]});if(!o.ok)throw new Error(`Failed to upload part ${n+1}`);const r=o.headers.get("ETag");if(!r)throw new Error(`Missing ETag for part ${n+1}`);i.push({PartNumber:n+1,ETag:r})}return i}))}finalizeUpload(t,e){return o(this,void 0,void 0,(function*(){this.filetsone&&this.filetsone.triggerHook("finalize_multipart_upload",t,e);const i=yield fetch(this.settings.finalizeMultipartUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({request_id:t,parts:e})});if(!i.ok)throw new Error("Failed to finalize upload");return yield i.json()}))}}class s{upload(t,e){return i=this,n=void 0,r=function*(){try{const i=new FormData;i.append("file",e);const n=yield fetch(t.url,{method:"POST",body:i,headers:{Accept:"application/json"}});if(n.ok)return yield n.json();console.error("File upload failed.",n.statusText)}catch(t){console.error("Error during file upload:",t)}throw new Error("Upload failed")},new((o=void 0)||(o=Promise))((function(t,e){function s(t){try{a(r.next(t))}catch(t){e(t)}}function l(t){try{a(r.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof o?i:new o((function(t){t(i)}))).then(s,l)}a((r=r.apply(i,n||[])).next())}));var i,n,o,r}}class l{constructor(t){this.uploadOnDrop=!1,this.mode="server",this.url="",this.uploader=new s,this.queue=[],this.hooks=new Map,this.element=this.getElement(t),this.s3Settings=new n,this.settings=new i,this.setupEventListeners()}setUploadMode(t){this.mode=t,"s3"==this.mode?this.uploader=new r:"server"==this.mode&&(this.uploader=new s)}process(){if(null!==this.queue){this.triggerHook("processing",this.queue);for(let t=0;t<this.queue.length;t++)this.uploader.upload(this,this.queue[t])}}registerHook(t,e){this.hooks.has(t)||this.hooks.set(t,[]),this.hooks.get(t).push(e)}triggerHook(t,...e){var i;null===(i=this.hooks.get(t))||void 0===i||i.forEach((t=>t(...e)))}getElement(t){const e=document.querySelector(t);if(!e)throw new Error(`Element not found: ${t}`);return e}setupEventListeners(){["dragenter","dragover","dragleave","drop"].forEach((t=>{this.element.addEventListener(t,(t=>t.preventDefault()))})),this.element.addEventListener("drop",(t=>{return e=this,i=void 0,o=function*(){var e;const i=null===(e=t.dataTransfer)||void 0===e?void 0:e.files;if(i&&i.length>0)for(let t=0;t<i.length;t++)this.triggerHook("dropped",i[t]),this.queue.push(i[t]),this.settings.uploadOnDrop&&this.uploader.upload(this,i[t])},new((n=void 0)||(n=Promise))((function(t,r){function s(t){try{a(o.next(t))}catch(t){r(t)}}function l(t){try{a(o.throw(t))}catch(t){r(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,l)}a((o=o.apply(e,i||[])).next())}));var e,i,n,o}))}}var a=e.A;export{a as default};